---
- name: Create autorun script directory for prov "{{ prov_dir }}"
  file: path="{{ store_prov_dir }}/boot/autorun" state=directory

- name: Generate pxelinux.cfg
  template:
    src: pxelinux.cfg.j2
    dest: "{{ store_prov_dir }}/boot/pxelinux.cfg"

- name: Generate autorun script for SSH key setup
  template:
    src: "autorun/{{ item }}"
    dest: "{{ store_prov_dir }}/boot/autorun/{{ item | splitext | first }}"
  with_items:
    - autorun1.j2
    - autorun2.j2
    - autorun9.j2

- name: Build dnsmasq boot options config
  template: src=prov-bootoptions.conf.j2 dest="{{ zygote_config.config_root }}/dnsmasq-{{ zygote_network.interface }}.conf.d/boot-{{ prov_id }}-options.conf"
